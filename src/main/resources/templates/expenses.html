<main class="flex items-center flex-col">

    <div id="month-navigator"
         class="flex items-center justify-between gap-4 px-4 py-3 bg-white shadow-md rounded-xl w-full max-w-3xl mb-6"
         hx-swap="outerHTML"
         hx-target="main"
         hx-include="#months-selector">

        <!-- Previous Button -->
        <button class="px-3 py-1.5 bg-gray-200 hover:bg-gray-300 text-sm font-medium rounded-md transition"
                th:hx-get="|/expenses/${previous.getYear()}/${previous.getMonthValue()}|">
            ← Previous
        </button>

        <!-- Selector -->
        <div class="flex items-center gap-2">
            <label for="months-selector" class="text-sm font-medium text-gray-700">Months to show:</label>
            <div class="relative">
                <select id="months-selector"
                        name="numOfMonths"
                        class="appearance-none w-20 px-3 py-2 pr-8 rounded-md border border-gray-300 bg-white text-base font-medium shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500"
                        th:value="${numOfMonths}"
                        th:hx-get="|/expenses/${current.getYear()}/${current.getMonthValue()}|"
                        hx-trigger="change">
                    <option th:each="i : ${#numbers.sequence(1, 4)}"
                            th:value="${i}"
                            th:text="${i}"
                            th:selected="${i==numOfMonths}"></option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
                    <svg class="h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.584l3.71-4.353a.75.75 0 111.14.976l-4.25 5a.75.75 0 01-1.14 0l-4.25-5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                    </svg>
                </div>
            </div>
        </div>

        <!-- Next Button -->
        <button class="px-3 py-1.5 bg-gray-200 hover:bg-gray-300 text-sm font-medium rounded-md transition"
                th:hx-get="|/expenses/${next.getYear()}/${next.getMonthValue()}|">
            Next →
        </button>
    </div>

    <!--/* In the future this may contain several month details */-->
    <div id="months-overview" class="flex flex-row gap-x-6 px-4">

        <div th:each="month: ${allMonths}" th:id="${month.month()}" class="bg-white shadow-lg rounded-2xl w-80 overflow-hidden">

            <!-- Header -->
            <div class="bg-gray-800 text-white text-center py-2 font-semibold text-lg" th:text="${month.getMonthText()}">Month</div>

            <!-- Overview Section -->
            <div class="grid grid-cols-2 gap-y-2 px-4 py-4 text-sm text-gray-800 border-b border-gray-300">
                <span class="font-semibold">Total Spent</span>
                <span class="text-right font-medium" th:text="|${month.totalExpense()}€|">€0</span>

                <span class="font-semibold">Total Earned</span>
                <span class="text-right font-medium" th:text="|${month.totalIncome()}€|">€0</span>

                <span class="font-semibold">Balance</span>
                <span class="text-right font-medium" th:text="|${month.balance()}€|">€0</span>
            </div>

            <!-- Category Breakdown -->
            <div class="p-4">
                <span th:if="${#lists.isEmpty(month.categories())}" class="text-gray-500 text-sm">No data</span>

                <th:block th:unless="${#lists.isEmpty(month.categories())}" th:each="category: ${month.categories()}">

                    <!-- Main Category -->
                    <div class="flex justify-between items-center mt-4 mb-2 border-b pb-1 border-gray-400">
                        <span class="font-semibold text-base text-gray-800" th:text="${category.category}">Category</span>
                        <span class="font-semibold text-sm text-green-600" th:text="|${category.totalAmount}€|">€0</span>
                    </div>

                    <!-- Expenses (subcategories) -->
                    <th:block th:each="expense: ${category.expenses}">
                        <div class="grid grid-cols-4 text-sm text-gray-700 py-1 border-b border-gray-100">
                            <span class="col-span-2 truncate" th:text="${expense.payee}">Payee</span>
                            <span class="text-center text-gray-500" th:text="${expense.date}">Date</span>
                            <span class="text-right font-medium" th:text="|${expense.amount}€|">€0</span>
                        </div>
                    </th:block>
                </th:block>
            </div>
        </div>
    </div>
</main>
